<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
  />
  <meta name="apple-mobile-web-app-capable" content="no" />
  <title>Terranium</title>
  <script src="https://cdn.jsdelivr.net/npm/nipplejs@0.10.0/dist/nipplejs.min.js"></script>
  <style>
    body { margin:0; overflow:hidden; background:#000; touch-action:none; }
    canvas { display:block; }
  </style>
</head>
<body>
  <!-- No manifest link. No service-worker registration. -->
  <script type="module">
    // --- Hard kill previously-registered service workers + caches ---
    async function nukeSWAndCaches() {
      try {
        if ('serviceWorker' in navigator) {
          const regs = await navigator.serviceWorker.getRegistrations();
          await Promise.all(regs.map(r => r.unregister()));
        }
      } catch (e) { console.warn('SW unregister failed:', e); }

      try {
        if ('caches' in window) {
          const names = await caches.keys();
          await Promise.all(names.map(n => caches.delete(n)));
        }
      } catch (e) { console.warn('Cache clearing failed:', e); }
    }

    // After cleanup, load the app with a cache-busting query param
    (async () => {
      await nukeSWAndCaches();
      const ts = Date.now();
      await import(`./src/main.js?v=${ts}`);
    })();
  </script>
</body>
</html>